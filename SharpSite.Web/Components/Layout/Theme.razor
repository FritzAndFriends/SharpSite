@inject IThemeManager ApplicationStateManager
@using SharpSite.Abstractions.Theme

@foreach (var item in (Stylesheets))
{
	var theUrl = item.StartsWith("http") ? item : FormatThemeStylesheetLocation(item);
	<link rel="stylesheet" type="text/css" href="@theUrl" />
}

@code {
	IHasStylesheets? ThemeComponent;

	string[] Stylesheets = [];

	protected override void OnInitialized()
	{

		ThemeComponent = ApplicationStateManager.ThemeType is not null && ApplicationStateManager.ThemeType != null
			? Activator.CreateInstance(ApplicationStateManager.ThemeType) as IHasStylesheets
			: null;

		Stylesheets = ThemeComponent?.Stylesheets ?? [];

		base.OnInitialized();
	}

	string FormatThemeStylesheetLocation(string stylesheet)
	{
		return $"/Plugins/{ApplicationStateManager.CurrentState.CurrentTheme}/{stylesheet}";
	}

}
